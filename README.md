# BETTER API Python Client & Explorer

This project provides a set of Python scripts to interact with the [BETTER API](https://better.lbl.gov/documentation/api-v1-overview/), allowing users to programmatically create portfolios and buildings, add utility bill data, trigger building energy analysis, and retrieve/explore the results.

## Purpose

The primary goal of these scripts is to facilitate the exploration and testing of the BETTER API's capabilities, particularly focusing on:
1.  Generating synthetic building and utility data [To mimic the real-world buildings and utility bills].
2.  Running building-level energy analyses.
3.  Retrieving and understanding the structure of the analysis results.
4.  Testing different analysis parameters.

## Files in this Project

*   `config.py`: **Crucial configuration file.** Stores the API Key, Base URL, and user information. **You MUST edit this file before running the scripts.**
*   `api_client.py`: A module containing functions to make calls to the various BETTER API endpoints (e.g., creating portfolios/buildings, managing utility bills, running analyses, polling for results).
*   `data_generator.py`: An interactive script to help populate the BETTER platform with sample portfolios, buildings (with different space types), and utility bills (with options for full or missing data).
*   `main_explorer.py`: An interactive script to trigger and retrieve energy analysis results for specified buildings. It allows users to select buildings, choose analysis parameters, and view a summary of the outcomes.

## Prerequisites

*   Python 3.x
*   The `requests` Python library:
    ```bash
    pip install requests
    ```
*   A valid API Key and Base URL for the BETTER API platform you intend to use.

## Setup Instructions

1.  **Clone the Repository (or download the files):**
    ```bash
    # git clone <your-repository-url>
    # cd <repository-name>
    ```
2.  **Install Dependencies:**
    ```bash
    pip install requests
    ```
3.  **Configure API Access (IMPORTANT!):**
    *   Open the `config.py` file.
    *   Replace `"YOUR_ACTUAL_API_KEY_HERE"` with your valid BETTER API Key.
    *   Replace `"YOUR_ACTUAL_BETTER_API_BASE_URL_HERE"` with the correct base URL for your BETTER API instance (e.g., `"https://better.lbl.gov/api/v1"`).
    *   The `USER_LOGIN` and `CURRENT_UTC_TIME` fields are pre-filled based on initial setup but can be updated if needed.
    *   Save the `config.py` file.

## How to Run

The scripts are designed to be run from your terminal or command prompt, from the directory where you saved the files.

1.  **Generate Test Data (Optional, but recommended for first-time use):**
    *   This script helps create portfolios, buildings, and utility bills.
    *   Run:
        ```bash
        python data_generator.py
        ```
    *   Follow the interactive prompts. Make a note of any Building IDs created, as you'll need them for the next step.

2.  **Run Building Analysis:**
    *   This script triggers and displays the results of the BETTER building analysis.
    *   Run:
        ```bash
        python main_explorer.py
        ```
    *   The script will ask for:
        *   Building ID(s) to analyze (comma-separated).
        *   The desired `savings_target` (e.g., NOMINAL, AGGRESSIVE).
        *   The `min_model_r_squared` value.
    *   The script will then poll the API and display a summary of the analysis once complete.

## Key Features & Learnings

*   **Interactive Data Generation:** `data_generator.py` provides a user-friendly way to create test entities.
*   **API Client Abstraction:** `api_client.py` centralizes API interactions.
*   **Analysis Workflow:** `main_explorer.py` demonstrates the process of triggering, polling, and retrieving analysis results.
*   **API Field Requirement:** Discovered that the `benchmark_data_type` field (set to `"DEFAULT"`) is required when triggering a single building analysis, in addition to `savings_target` and `min_model_r_squared`.
*   **Synthetic Data Impact:** The quality and completeness of utility bill data (even if synthetically generated) significantly impact the meaningfulness of the analysis results. If results show many "N/A" or "None" values despite a "COMPLETE" analysis status, it often points to insufficient or unrealistic input utility data.

## Troubleshooting / Current Status

*   **`benchmark_data_type` Error:** Initially, `main_explorer.py` failed to trigger analysis due to a missing `benchmark_data_type` field. This was resolved by adding it to the payload in `api_client.py`'s `run_building_analysis` function.
*   **Synthetic Data Quality:** Current results with synthetically generated data (as of 2025-05-22) indicate that while the API completes the analysis, the outputs (e.g., EE measures, savings) are often "N/A". This suggests the synthetic utility bills generated by `data_generator.py` might need to be more robust (e.g., ensuring a full 12 months of continuous, realistic data for at least one primary fuel type) for the API to produce more detailed results. Further investigation into the generated bills for specific buildings is recommended if results are sparse.

## Future Enhancements (Potential)

*   More sophisticated synthetic data generation in `data_generator.py` (e.g., patterns based on space type, more varied consumption).
*   Implementation of portfolio-level analysis workflows.
*   Option to output analysis results to a file (e.g., CSV, JSON).
*   More detailed parsing and presentation of the `benchmark` and `assessment_visualizations` sections from the API response.

---
